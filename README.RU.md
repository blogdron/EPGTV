# EPGTV - Программа телепередач для mpv плеера

```diff
-(В разработке) Только Linux и похожие *NIX системы поддерживаются
```

## [README on English language](README.md)

Простое отображение `EPG` информации для `IPTV M3U` плейлистов в [mpv](https://mpv.io).
`EPGTV` это просто чуть расширенный форк проекта [mpvEPG v0.3](https://github.com/dafyk/mpvEPG)
`EPGTV` открывает `M3U` файл или `URL` ссылку и автоматически загружает `EPG` данные в свой кэш.
После сохранения кэша сразу отображает программу телепередач на сегодня и завтра, если доступно.
Если доступно то `EPGTV` отображает описание телепередач. Первый старт может быть долгим
так как данные ещё не собраны, последующие запуски будут быстрее за счёт переиспользования кэша.

## Снимок экрана

![screenshot](.screenshot/screenshot.png)


## Зависимости

 * `mpv`  Этот скрипт работает внутри `mpv` плеера
 * `curl` Нужно для загрузки `EPG` данных
 * `gzip` Нужно для `zcat` утилиты, которая распаковывает `zip/gzip` архивы

```
apt install mpv curl gzip
```

## Установка

Вам нужно установить `EPGTV` **каталог** внутри `$HOME/.config/mpv/scripts/`

```
git clone https://github.com/blogdron/EPGTV  $HOME/.config/mpv/scripts/EPGTV
```

## Обновление 

```
cd $HOME/.config/mpv/scripts/EPGTV && git pull
```

## Использование

`mpv iptv.m3u` или `mpv https://example.com/iptv.m3u`

 * `h` -  Отобразить программу телепередач
 * `n` -  Прокручивает вниз ТВ информацию, отображаемую на сегодня и на завтра
 * `u` -  Обновляет программу телепередач текущего плейлиста (кэш не из плейлиста будет выгружен)
 * `g` -  Загружает весь имеющийся кэш для поиска телеканала (может быть полезно)
 * `esc` - Скрыть отображаемую информацию

## На заметку

Данные кэша ТВ телепередач находятся тут

```
$HOME/.cache/EPGTV/
```


## Корректный пример IPTV M3U

```
#EXTM3U url-tvg="http://epg.it999.ru/ru2.xml.gz, https://iptvx.one/epg/epg.xml.gz" tvg-shift="+3"
#EXTINF:-1 tvg-id="pervy" tvg-logo="https://epgx.site/p/pervy.png" group-title="Общественные",Первый (HD ready)
http://edge4.1internet.tv/dash-live2/streams/1tv-dvr/1tvdash.mpd
```

Для получения ТВ иформации, `M3U`  плейлист должен иметь

* `url-tvg`  тег с ссылкой на `файл` или `URL` на текстовые `XML` данные или архивы gz/zip
* `tvg-id` идентификатор канала поиска канала и его телепрограммы в `EPG` данных

Некоторые `IPTV M3U` не имеют `tvg-id`, в этом случае используется другой механизм
поиска, поис ведётся по названию потока в `M3U` или по окончанию ссылки потока
