# EPGTV - Программа телепередач для mpv плеера

## [README on English language](README.md)

Простое отображение `EPG` информации для `IPTV M3U` плейлистов в [mpv](https://mpv.io).
`EPGTV` это просто чуть расширенный форк проекта [mpvEPG v0.3](https://github.com/dafyk/mpvEPG)
`EPGTV` открывает `M3U` файл или `URL` ссылку и автоматически загружает `EPG` данные в свой кэш.
После сохранения кэша сразу отображает программу телепередач на сегодня и завтра, если доступно.
Если доступно то `EPGTV` отображает описание телепередач. Первый старт может быть долгим
так как данные ещё не собраны, последующие запуски будут быстрее за счёт переиспользования кэша.

 * Работа провена на `mpv 0.38.0`

## Альтернатива

 * https://codeberg.org/liya/yuki-iptv

## Снимок экрана

![screenshot](.screenshot/screenshot.png)


## Зависимости

 * `mpv`  Этот скрипт работает внутри `mpv` плеера
 * `curl` Нужно для загрузки `EPG` данных
 * `gzip` Нужно для распаковки `zip/gzip` архивов

```
apt install mpv curl gzip
```

## Установка

Вам нужно установить `EPGTV` **каталог** внутри `$HOME/.config/mpv/scripts/`

```
git clone https://github.com/blogdron/EPGTV  $HOME/.config/mpv/scripts/EPGTV
```

## Обновление

```
cd $HOME/.config/mpv/scripts/EPGTV && git pull
```

## Использование
(я рекомендую включать --hwdec для аппаратного ускорения)

 * `mpv --hwdec iptv.m3u`
 * `mpv --hwdec https://example.com/iptv.m3u`

## Управление

 * `h` -  Отобразить программу телепередач (автоматически закрывается через 5 секунд)
 * `y` -  Отобразить программу телепередач как `h` но в режиме переключателя показать/скрыть
 * `n` -  Прокручивает вниз ТВ информацию, отображаемую на сегодня и на завтра
 * `u` -  Обновляет программу телепередач текущего плейлиста (кэш не из плейлиста будет выгружен)
 * `g` -  Загружает весь имеющийся кэш для поиска телеканала (может быть полезно)
 * `esc` - Скрыть отображаемую информацию

`EPGTV` для более быстрой работы использует кэш, он автоматически создаётся
при первом обращении к плейлисту, если же спустя время вы видите сообщение
об отсутствии данных для телеканала то вероятно просто кеш более не актуален, и
нужно **обновить кэш вручную** нажав `u` если у источника `EPG` данных было обновление
то новый кеш будет актуален и все данные будут отображены, обычно `EPG` данные хранят
информацию на несколько дней вперёд, но это не всегда так.


## Конфигурация

В каталоге скрипта есть файл конфигурации `conf.lua` настраивайте всё на ваш вкус

## На заметку

Данные кэша ТВ телепередач находятся тут

```
$HOME/.cache/EPGTV/
```


## Корректный пример IPTV M3U

```
#EXTM3U url-tvg="http://example.com/epg.xml.gz, https://example.com/epg.xml" tvg-shift="+3"
#EXTINF:-1 tvg-id="channel_id"  group-title="Группа телеканала",Имя телеканала
http://example.com/tvstream
```

Для получения ТВ иформации, `M3U`  плейлист должен иметь

* `url-tvg`  тег с ссылкой на `файл` или `URL` на текстовые `XML` данные или архивы gz/zip
* `tvg-id` идентификатор канала поиска канала и его телепрограммы в `EPG` данных

Некоторые `IPTV M3U` не имеют `tvg-id`, в этом случае используется другой механизм
поиска, поис ведётся по названию потока в `M3U` или по окончанию ссылки потока

--------------

# Windows

Я не использую `Windows`, но вот описание где и как мне удалось лишь один раз
убедится в работоспособности скрипта для операционной системы `Windows 7`.

## Подготовка

* Скачать `mpv`  и распаковать `static-mpv.7zip` в `static-mpv`
 * https://github.com/eko5624/mpv-win64/releases/tag/2024-04-01
* Скачать `EPGTV` и распаковать в `static-mpv\portable-config\scripts\EPGTV`
  * https://github.com/blogdron/EPGTV/archive/refs/heads/master.zip
* Скачать `curl` и распаковать в `C:\Program Files\curl`
  * https://curl.se/windows/
* Скачать `gzip` и паспаковать в `C:\Program Files\gzip`
  * https://sourceforge.net/projects/gnuwin32/files/gzip/1.3.12-1/gzip-1.3.12-1-bin.zip/download
* Открыть файл `static-mpv\portable-config\scripts\EPGTV\conf.lua`
  * поменять значения `curl_path` и `gzip_path` на такие

```lua
curl_path = 'C:\\Program Files\\curl\\bin\\curl.exe', -- set fullpath to you curl installation
gzip_path = 'C:\\Program Files\\gzip\\bin\\gzip.exe', -- set fullpath to you gzip installation
```

Всё, теперь должно работать, на самом деле я тут описал всё слишком подробно.
Вам нужно лишь распаложить каталог `EPGTV` с его содержимым в каталоге скрипта
вашего `mpv` плеера, он может находится в разных местах в зависимости от вашего
варианта на `Windows` далее, нужно установить `curl` и `gzip` и установить до них
полные пути в конфигурационном файле `EPGTV` и всё. Эти зависимости вы можете взять
из других мест, и они могут надодится по другим путям, исходите из вашего случая.


